(this["webpackJsonpspotisurf-react"]=this["webpackJsonpspotisurf-react"]||[]).push([[0],{26:function(e,t,r){},27:function(e,t,r){},46:function(e,t,r){},47:function(e,t,r){},48:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r(2),s=r.n(a),i=r(20),o=r.n(i),c=(r(26),r(10)),l=r(4),u=r(5),d=r(7),h=r(6),g=(r(27),r(3)),f=r.n(g),p=function(e,t){for(var r,n=arguments.length,a=new Array(n>2?n-2:0),s=2;s<n;s++)a[s-2]=arguments[s];if(window.DEBUG){var i="";void 0!==t&&"string"===typeof t&&t.startsWith("css")?t=t.split("css").slice(1):(arguments.length>1&&(i=t),t="font-size: 16px; color: orange;"),(r=console).log.apply(r,["%c".concat(e),t,i].concat(a))}},m="https://api.spotify.com/v1/",v="https://us-central1-functions-test-24b29.cloudfunctions.net/spotisurf?test=1",j={getToken:function(){var e=this;return p("getToken"),f.a.get(v).then((function(t){return console.log("%cset init token %s","color: green; font-size: 14px;",t.data.token),e.setToken(t.data.token),!0})).catch((function(e){throw console.warn("api.getToken(): FAILED to get initial token",e),new Error("api.getToken(): FAILED to get initial token")}))},setToken:function(e){p("setToken",e),f.a.defaults.headers.common.Authorization="Bearer "+e,localStorage.setItem("spotifyToken",e)},getSearchResults:function(e,t){var r=this;return p("getSearchResults",{text:e,errorHandler:t}),f.a.get(m+"search",{params:{q:e,type:"artist"}}).catch((function(n){return console.log("CATCH getSearchResults (API)"),r.handleRequestError(n,{request:"getSearchResults",args:[e],errorHandler:t})}))},getArtistTopTracks:function(e,t){var r=this;return p("getArtistTopTracks",{id:e,errorHandler:t}),f.a.get(m+"artists/".concat(e,"/top-tracks"),{params:{country:"AU"}}).catch((function(n){return console.log("CATCH getArtistTopTracks (API)"),r.handleRequestError(n,{request:"getArtistTopTracks",args:[e],errorHandler:t})}))},getArtistRecommendations:function(e,t,r){var n=this;p("getArtistRecommendations",{id:e,energy:t,errorHandler:r});var a={seed_artists:e};return t&&(a.instrumentalness=t),f.a.get(m+"recommendations",{params:a}).catch((function(t){return console.log("CATCH getArtistRecommendations (API)"),n.handleRequestError(t,{request:"getArtistRecommendations",args:[e],errorHandler:r})}))},getArtistInfo:function(e,t){var r=this;return p("getArtistInfo",{id:e,errorHandler:t}),f.a.get(m+"artists/".concat(e)).catch((function(n){return console.log("CATCH getArtistInfo (API)"),r.handleRequestError(n,{request:"getArtistInfo",args:[e],errorHandler:t})}))},handleRequestError:function(e,t){return p("handleRequestError",{err:e,req:t}),401!==e.response.status?(console.dir(e),void console.warn("API ERROR",t.request,e.status,e.statusText)):(console.log("%cGenerating new token...","color: orange; font-weight: bold",t),t.errorHandler&&t.errorHandler("Generating new token..."),j.generateNewTokenAndRetry(t))},generateNewTokenAndRetry:function(e){var t=this;return p("generateNewTokenAndRetry",{lastRequest:e}),f.a.get(v).then((function(r){return t.setToken(r.data.token),console.log("%crefreshed token","font-size: 14pt; font-weight: bold;",r.data),e.errorHandler&&e.errorHandler(""),console.log("Re-try API call:",e.request,e),j[e.request].apply(j,Object(c.a)(e.args))})).catch((function(t){throw console.warn("TOKEN REFRESH FAIL"),console.dir(t),e.errorHandler("Unable to refresh API token"),new Error("Unable to refresh API token")}))}},k=j,x=(r(46),function(e){Object(d.a)(r,e);var t=Object(h.a)(r);function r(){var e;Object(l.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={results:[],errorMsg:""},e}return Object(u.a)(r,[{key:"componentDidMount",value:function(){var e=this;console.log("<SearchResults>",this.props.searchText),k.getSearchResults(this.props.searchText,this.props.onError).then((function(t){return e.setState({results:t.data.artists.items})}))}},{key:"componentDidUpdate",value:function(e,t){var r=this;this.props.searchText!==e.searchText&&(this.setState({results:[]}),k.getSearchResults(this.props.searchText,this.props.onError).then((function(e){return r.setState({results:e.data.artists.items})})))}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{children:[Object(n.jsxs)("h3",{children:["Results for ",Object(n.jsx)("em",{children:this.props.searchText})]}),Object(n.jsx)("ul",{id:"resultsList",children:this.state.results.map((function(t){return Object(n.jsx)("li",{className:"result",style:{backgroundImage:y(t)},onClick:function(){return e.props.onArtistSelect(t.id,t.name,t.genres,t.images)},children:Object(n.jsx)("div",{className:"name",children:Object(n.jsx)("strong",{children:t.name})})},t.id)}))})]})}}]),r}(s.a.Component)),y=function(e){return"images"in e&&e.images.length>0?"url("+e.images[0].url+")":""},b=x,w=r(9),O=r(8);r(47);window.DEBUG=!0;var A=function(e){Object(d.a)(r,e);var t=Object(h.a)(r);function r(){var e;Object(l.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={tracks:[],recommendations:[],nowPlaying:{},lastPlaying:{},sliders:{energy:null},loadingMsg:"Loading artist..."},e.audioPlayers=[],e.handleKeyDown=function(t){if("searchText"!==t.target.id){var r=!0,n=e.state,a=n.nowPlaying,s=n.lastPlaying;switch(t.key){case" ":void 0===a.audio?void 0===s.audio?(T.fadeIn(e.audioPlayers[0]),e.setState({nowPlaying:{track:e.state.tracks[0],audio:e.audioPlayers[0],index:0}})):(T.fadeIn(s.audio),e.setState({nowPlaying:Object(O.a)({},s)})):(T.fadeOut(a.audio),e.setState({lastPlaying:Object(O.a)({},a),nowPlaying:{}}));break;case"Enter":if(void 0===e.state.nowPlaying.audio)return;a.index>=10?window.open(a.track.artists[0].external_urls.spotify):(window.open(a.track.external_urls.spotify),T.fadeOut(a.audio));break;case"ArrowLeft":var i=T.playPreviousTrack(a,e.audioPlayers),o=i.prevAudio,c=i.prevIndex;if(null===c)return;e.setState({nowPlaying:{track:c<10?e.state.tracks[c]:e.state.recommendations[c-10],audio:o,index:c}});break;case"ArrowRight":var l=T.playNextTrack(a,e.audioPlayers),u=l.nextAudio,d=l.nextIndex;if(null===d)return;e.setState({nowPlaying:{track:d<10?e.state.tracks[d]:e.state.recommendations[d-10],audio:u,index:d}});break;default:r=!1}r&&t.preventDefault()}},e.updateSlider=function(t){var r=t.target,n=r.name,a=r.value;console.log("slider update",{name:n,value:a}),e.setState({sliders:Object(O.a)(Object(O.a)({},e.state.sliders),{},Object(w.a)({},n,parseFloat(a)))}),k.getArtistRecommendations(e.props.artist.id,a,e.props.onError).then((function(t){return e.setState({recommendations:t.data.tracks})}))},e.handleTrackClick=function(t,r,n){if(e.audioPlayers[n]){var a=t.currentTarget.firstElementChild,s=e.state.nowPlaying;s.audio&&(T.fadeOut(s.audio),s.track.id===r.id)?e.setState({lastPlaying:Object(O.a)({},e.state.nowPlaying),nowPlaying:{}}):(T.fadeIn(a),e.setState({nowPlaying:{track:r,audio:a,index:n}}))}},e.handleEndOfTrack=function(t){var r=T.playNextTrack(e.state.nowPlaying,e.audioPlayers),n=r.nextAudio,a=r.nextIndex;null!==a&&e.setState({nowPlaying:{track:a<10?e.state.tracks[a]:e.state.recommendations[a-10],audio:n,index:a}})},e.viewRecommendedArtist=function(t,r){t.stopPropagation(),e.props.onViewArtist(r.artists[0].id)},e}return Object(u.a)(r,[{key:"fetchDetails",value:function(){var e=this;this.state.nowPlaying.audio&&T.fadeOut(this.state.nowPlaying.audio),this.setState({nowPlaying:{},lastPlaying:{}}),k.getArtistTopTracks(this.props.artist.id,this.props.onError).then((function(t){return e.setState({tracks:t.data.tracks,loadingMsg:""})})),k.getArtistRecommendations(this.props.artist.id,this.state.sliders.energy,this.props.onError).then((function(t){return e.setState({recommendations:t.data.tracks})}))}},{key:"componentDidMount",value:function(){console.log("<ArtistDetails>",this.props.artist.id),this.fetchDetails(),window.addEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(e,t){this.props.artist.id!==e.artist.id&&(p("Update fetchDetails()",this.props.artist),this.fetchDetails())}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{id:"details",style:{backgroundImage:P(this.props.artist.images)},children:[Object(n.jsx)(S,{name:this.props.artist.name,tracks:this.state.tracks,genres:this.props.artist.genres}),Object(n.jsxs)("div",{className:"grid",children:[Object(n.jsxs)("div",{className:"topTracks",children:[Object(n.jsx)("h4",{children:"Top Tracks"}),Object(n.jsx)("ul",{children:this.state.tracks.map((function(t,r){return Object(n.jsx)(I,{index:r,item:t,nowPlaying:e.state.nowPlaying,clickHandler:e.handleTrackClick,playerRefs:e.audioPlayers,onTrackEnd:e.handleEndOfTrack,children:Object(n.jsx)("em",{children:t.name})},t.id)}))})]}),Object(n.jsxs)("div",{className:"recs",children:[Object(n.jsx)("h4",{children:"Recommendations"}),Object(n.jsx)("ul",{children:this.state.recommendations.map((function(t,r){return Object(n.jsxs)(I,{recClass:"rec",item:t,index:r+10,nowPlaying:e.state.nowPlaying,clickHandler:e.handleTrackClick,playerRefs:e.audioPlayers,onTrackEnd:e.handleEndOfTrack,children:["\xa0 ",t.artists[0].name," \xa0",Object(n.jsxs)("span",{className:"trackName",children:["\u2013 ",t.name]}),Object(n.jsx)("span",{className:"goto",onClick:function(r){return e.viewRecommendedArtist(r,t)},children:"view"})]},t.id)}))})]})]})]})}}]),r}(s.a.Component),T={playPreviousTrack:function(e,t){if(void 0===e.track)return{prevAudio:null,prevIndex:null};for(var r=e.index-1,n=t[r];r>=0&&!n;)n=t[--r];return n?(this.fadeOut(e.audio),this.fadeIn(n),{prevAudio:n,prevIndex:r}):{prevAudio:null,prevIndex:null}},playNextTrack:function(e,t){if(void 0===e.track)return{prevAudio:null,prevIndex:null};for(var r=e.index+1,n=t[r];r<t.length&&!n;)n=t[++r];return n?(this.fadeOut(e.audio),this.fadeIn(n),{nextAudio:n,nextIndex:r}):{nextAudio:null,nextIndex:null}},fadeOut:function(e){if(e.volume)var t=e.volume,r=setInterval((function(){t-=.08,e.volume=t.toFixed(1),t.toFixed(1)<=0&&(clearInterval(r),e.pause(),e.volume=1)}),50)},fadeIn:function(e){e.play();var t=0;e.volume=t;var r=setInterval((function(){t+=.08,e.volume=t.toFixed(1),t.toFixed(1)>=1&&clearInterval(r)}),50)}},P=function(e){return e&&e.length>0?"url("+e[0].url+")":""},I=function(e){var t=e.item,r=e.index,a=e.nowPlaying,s=e.clickHandler,i=e.children,o=e.playerRefs,c=e.onTrackEnd,l=e.recClass;return Object(n.jsxs)("li",{className:" player ".concat(l,"\n       ").concat(t.preview_url?"hasPreview":"noPreview","\n       ").concat(a.index===r?"playing":"","\n      "),onClick:function(e){return s(e,t,r)},children:[t.preview_url?Object(n.jsx)("audio",{ref:function(e){return o[r]=e},onEnded:c,children:Object(n.jsx)("source",{type:"audio/mpeg",src:t.preview_url})}):void 0,Object(n.jsx)("span",{className:"controls"}),i]})},S=function(e){var t=e.name,r=e.tracks,a=e.genres;return Object(n.jsxs)("div",{className:"heading",children:[Object(n.jsx)("h2",{children:Object(n.jsx)("a",{id:"artistName",target:"_blank",rel:"noreferrer",href:r.length>0?r[0].artists[0].external_urls.spotify:void 0,title:"View ".concat(t," on Spotify"),children:t})}),Object(n.jsx)("span",{className:"genres",children:a&&a.slice(0,6).join(", ")})]})},E=A;window.DEBUG=!0;var R=function(e){Object(d.a)(r,e);var t=Object(h.a)(r);function r(e){var n;return Object(l.a)(this,r),(n=t.call(this,e)).handleChange=function(e){n.setState({query:e.target.value})},n.setCurrentArtist=function(e,t,r,a){n.state.currentArtist.id!==e&&n.setState({currentArtist:{id:e,name:t,genres:r,images:a},breadcrumbTrail:[].concat(Object(c.a)(n.state.breadcrumbTrail),[{id:e,name:t}])})},n.setErrorMsg=function(e){n.setState({errorMsg:e})},n.handleSubmit=function(e){e.preventDefault(),n.setState({search:n.state.query}),n.searchInput.current.blur()},n.loadArtist=function(e){k.getArtistInfo(e,n.setErrorMsg).then((function(e){var t=e.data;return n.setCurrentArtist(t.id,t.name,t.genres,t.images)}))},n.state={query:"metz",search:"",currentArtist:{},errorMsg:"",breadcrumbTrail:[],relatedArtists:[]},n.searchInput=s.a.createRef(),n}return Object(u.a)(r,[{key:"componentDidMount",value:function(){var e=this;this.searchInput.current.focus();var t=new URLSearchParams(window.location.search),r=t.get("test");r&&this.setState({search:r});var n=t.get("token");if(n)k.setToken(n);else{var a=localStorage.getItem("spotifyToken");if(a)return console.log("localStorageToken loaded"),void k.setToken(a);k.getToken().catch((function(t){e.setState({errorMsg:"Error loading API token. Sorry!"})}))}}},{key:"render",value:function(){return Object(n.jsxs)("div",{className:"App",children:[Object(n.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(n.jsx)("input",{type:"text",id:"searchText",placeholder:"artist search",onChange:this.handleChange,ref:this.searchInput}),Object(n.jsx)("button",{children:"Go"})]}),Object(n.jsx)("div",{id:"status",children:this.state.errorMsg}),Object(n.jsx)(C,{trail:this.state.breadcrumbTrail,onClick:this.loadArtist}),void 0!==this.state.currentArtist.id&&Object(n.jsx)(E,{artist:this.state.currentArtist,onError:this.setErrorMsg,onViewArtist:this.loadArtist}),this.state.search.length>0&&Object(n.jsx)(b,{searchText:this.state.search,onArtistSelect:this.setCurrentArtist,onError:this.setErrorMsg})]})}}]),r}(s.a.Component),C=function(e){var t=e.trail,r=e.onClick;return t.length<2?null:Object(n.jsxs)("div",{id:"trail",children:[Object(n.jsx)("strong",{children:"Trail"}),": \xa0",Object(n.jsx)("ul",{className:"trail",children:t.map((function(e,a){return a===t.length-1?null:Object(n.jsxs)("li",{children:[Object(n.jsx)("div",{onClick:function(){return r(e.id)},children:e.name}),a<t.length-2&&Object(n.jsx)("span",{children:">"})]},e.id)}))})]})},N=R,D=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,49)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,s=t.getLCP,i=t.getTTFB;r(e),n(e),a(e),s(e),i(e)}))};o.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(N,{})}),document.getElementById("root")),D()}},[[48,1,2]]]);
//# sourceMappingURL=main.d88fff02.chunk.js.map